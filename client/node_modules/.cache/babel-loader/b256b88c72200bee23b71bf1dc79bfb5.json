{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useEffect, useState } from \"react\";\nimport { API, updateAPIHeader } from \"../../tools/API\";\nimport { LocalStroage } from \"../../tools/LocalStorage\";\nimport { getToday } from \"../../tools/time\";\n\nconst verifyToken = async () => {\n  const response = await API.auth().verifyToken(); //await API.post(\"/api/jwt/verify\", { token });\n\n  return response.data.decode;\n};\n\nexport const useLogin = () => {\n  _s();\n\n  const [user, setUser] = useState();\n  const [isTokenLoading, setLoadInToken] = useState(true);\n  const [isLoginLoading, setLoadInLoading] = useState(false);\n  const [isLoginHookLoading, setLoad] = useState(true);\n  useEffect(() => {\n    console.log(\"[login]TOKEN\", isTokenLoading, \"LOGIN\", isLoginLoading, \"RESULT: \", isTokenLoading || isLoginLoading);\n    setLoad(isTokenLoading || isLoginLoading);\n  }, [isTokenLoading, isLoginLoading]);\n\n  const setUserInToken = async () => {\n    try {\n      if (LocalStroage.accessToken().isEmpty()) {\n        console.log(\"user FIND! \");\n        LocalStroage.accessToken().set(undefined); // throw new Error(\"access_token not exists.\");\n\n        console.log(\"TOKEN\", isTokenLoading, \"LOGIN\", isLoginLoading, \"RESULT: \", isTokenLoading || isLoginLoading);\n        setLoadInToken(false);\n      } else {\n        // setLoadInToken(true);\n        const {\n          username\n        } = await verifyToken();\n        console.log(\"user find! \", username);\n        setLoadInToken(false);\n        setUser(username);\n      }\n    } catch (error) {\n      alert(error);\n      setLoadInToken(false);\n      setUser(undefined);\n      LocalStroage.accessToken().remove();\n    }\n  };\n\n  useEffect(() => {\n    console.log(\"USE EFFECT APPROACH\");\n    setUserInToken();\n  }, [user]);\n\n  const setDataInLocal = user => {\n    try {\n      console.log(\"TOKEN START\");\n      const date = getToday();\n      updateAPIHeader();\n\n      if (!LocalStroage.recordTime(\"wakeTime\").isEmpty()) {\n        const wakeTime = LocalStroage.recordTime(\"wakeTime\").get();\n        API.recordTime(user, date, \"wakeTime\").edit(wakeTime);\n        LocalStroage.recordTime(\"wakeTime\").remove();\n      }\n\n      if (!LocalStroage.recordTime(\"bedTime\").isEmpty()) {\n        const bedTime = LocalStroage.recordTime(\"bedTime\").get();\n        API.recordTime(user, date, \"bedTime\").edit(bedTime);\n        LocalStroage.recordTime(\"bedTime\").remove();\n      }\n\n      if (!LocalStroage.workList().isEmpty()) {\n        const workList = LocalStroage.workList(\"workList\").get();\n        API.workList(user, date).edit(workList);\n        LocalStroage.workList().remove();\n      }\n\n      if (!LocalStroage.todoList().isEmpty()) {\n        console.log(\"IS EMPTY TODO \");\n        const todoList = LocalStroage.todoList(\"todoList\").get();\n        API.todoList(user).edit(todoList);\n        LocalStroage.todoList().remove();\n      }\n    } catch (error) {\n      alert(error);\n    }\n  };\n\n  const authenticated = user != null;\n\n  const login = async (userInfo, socialType) => {\n    // setUser(signIn({ email, password }));\n    try {\n      setLoadInLoading(true); // const response = await API.post(`/auth/login/${socialType}`, {\n      //   userInfo,\n      // });\n\n      const response = await API.auth().login(socialType, userInfo);\n      const {\n        access_token,\n        username\n      } = response.data;\n      LocalStroage.accessToken().set(access_token);\n      setUser(username);\n      console.log(\"login success ~~~~~~~~~~~\");\n\n      if (!LocalStroage.accessToken().isEmpty()) {\n        setDataInLocal(username);\n        setLoadInLoading(false);\n      }\n    } catch (error) {\n      setLoadInLoading(false);\n      throw error;\n    }\n  };\n\n  const logout = () => {\n    setUser(null);\n    LocalStroage.accessToken().remove();\n    updateAPIHeader();\n  };\n\n  return [user, setUser, authenticated, login, logout, isLoginHookLoading];\n};\n\n_s(useLogin, \"zaolDfkYhAHWdwkUXw0VE4l/Opw=\");","map":{"version":3,"sources":["/home/invidam/hamburger_calender/client/src/hooks/user/useLogin.js"],"names":["useEffect","useState","API","updateAPIHeader","LocalStroage","getToday","verifyToken","response","auth","data","decode","useLogin","user","setUser","isTokenLoading","setLoadInToken","isLoginLoading","setLoadInLoading","isLoginHookLoading","setLoad","console","log","setUserInToken","accessToken","isEmpty","set","undefined","username","error","alert","remove","setDataInLocal","date","recordTime","wakeTime","get","edit","bedTime","workList","todoList","authenticated","login","userInfo","socialType","access_token","logout"],"mappings":"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","sourcesContent":["import { useEffect, useState } from \"react\";\nimport { API, updateAPIHeader } from \"../../tools/API\";\nimport { LocalStroage } from \"../../tools/LocalStorage\";\nimport { getToday } from \"../../tools/time\";\n\nconst verifyToken = async () => {\n  const response = await API.auth().verifyToken(); //await API.post(\"/api/jwt/verify\", { token });\n  return response.data.decode;\n};\n\nexport const useLogin = () => {\n  const [user, setUser] = useState();\n  const [isTokenLoading, setLoadInToken] = useState(true);\n  const [isLoginLoading, setLoadInLoading] = useState(false);\n  const [isLoginHookLoading, setLoad] = useState(true);\n  useEffect(() => {\n    console.log(\n      \"[login]TOKEN\",\n      isTokenLoading,\n      \"LOGIN\",\n      isLoginLoading,\n      \"RESULT: \",\n      isTokenLoading || isLoginLoading\n    );\n    setLoad(isTokenLoading || isLoginLoading);\n  }, [isTokenLoading, isLoginLoading]);\n  const setUserInToken = async () => {\n    try {\n      if (LocalStroage.accessToken().isEmpty()) {\n        console.log(\"user FIND! \");\n        LocalStroage.accessToken().set(undefined);\n        // throw new Error(\"access_token not exists.\");\n        console.log(\n          \"TOKEN\",\n          isTokenLoading,\n          \"LOGIN\",\n          isLoginLoading,\n          \"RESULT: \",\n          isTokenLoading || isLoginLoading\n        );\n        setLoadInToken(false);\n      } else {\n        // setLoadInToken(true);\n        const { username } = await verifyToken();\n        console.log(\"user find! \", username);\n        setLoadInToken(false);\n        setUser(username);\n      }\n    } catch (error) {\n      alert(error);\n      setLoadInToken(false);\n      setUser(undefined);\n      LocalStroage.accessToken().remove();\n    }\n  };\n  useEffect(() => {\n    console.log(\"USE EFFECT APPROACH\");\n    setUserInToken();\n  }, [user]);\n  const setDataInLocal = (user) => {\n    try {\n      console.log(\"TOKEN START\");\n      const date = getToday();\n      updateAPIHeader();\n      if (!LocalStroage.recordTime(\"wakeTime\").isEmpty()) {\n        const wakeTime = LocalStroage.recordTime(\"wakeTime\").get();\n        API.recordTime(user, date, \"wakeTime\").edit(wakeTime);\n        LocalStroage.recordTime(\"wakeTime\").remove();\n      }\n      if (!LocalStroage.recordTime(\"bedTime\").isEmpty()) {\n        const bedTime = LocalStroage.recordTime(\"bedTime\").get();\n        API.recordTime(user, date, \"bedTime\").edit(bedTime);\n        LocalStroage.recordTime(\"bedTime\").remove();\n      }\n      if (!LocalStroage.workList().isEmpty()) {\n        const workList = LocalStroage.workList(\"workList\").get();\n        API.workList(user, date).edit(workList);\n        LocalStroage.workList().remove();\n      }\n      if (!LocalStroage.todoList().isEmpty()) {\n        console.log(\"IS EMPTY TODO \");\n        const todoList = LocalStroage.todoList(\"todoList\").get();\n        API.todoList(user).edit(todoList);\n        LocalStroage.todoList().remove();\n      }\n    } catch (error) {\n      alert(error);\n    }\n  };\n  const authenticated = user != null;\n  const login = async (userInfo, socialType) => {\n    // setUser(signIn({ email, password }));\n    try {\n      setLoadInLoading(true);\n      // const response = await API.post(`/auth/login/${socialType}`, {\n      //   userInfo,\n      // });\n      const response = await API.auth().login(socialType, userInfo);\n      const { access_token, username } = response.data;\n      LocalStroage.accessToken().set(access_token);\n      setUser(username);\n      console.log(\"login success ~~~~~~~~~~~\");\n      if (!LocalStroage.accessToken().isEmpty()) {\n        setDataInLocal(username);\n        setLoadInLoading(false);\n      }\n    } catch (error) {\n      setLoadInLoading(false);\n      throw error;\n    }\n  };\n  const logout = () => {\n    setUser(null);\n    LocalStroage.accessToken().remove();\n    updateAPIHeader();\n  };\n\n  return [user, setUser, authenticated, login, logout, isLoginHookLoading];\n};\n"]},"metadata":{},"sourceType":"module"}