{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useEffect, useState } from \"react\";\nimport { API, APIv2, updateAPIHeader } from \"../../tools/API\";\nimport { LocalStroage } from \"../../tools/LocalStorage\";\nimport { getToday } from \"../../tools/time\";\n\nconst verifyToken = async () => {\n  const {\n    token\n  } = JSON.parse(localStorage.getItem(\"access_token\"));\n  const response = await API.post(\"/api/jwt/verify\", {\n    token\n  });\n  return response.data.decode;\n};\n\nexport const useLogin = () => {\n  _s();\n\n  const [user, setUser] = useState(\"Loading\");\n\n  const setUserInToken = async () => {\n    try {\n      if (!localStorage.getItem(\"access_token\") || localStorage.getItem(\"access_token\") === \"undefined\") {\n        localStorage.setItem(\"access_token\", \"undefined\");\n        throw new Error(\"access_token not exists.\");\n      }\n\n      const {\n        username\n      } = await verifyToken();\n      console.log(\"user find! \", username);\n      setUser(username);\n    } catch (error) {\n      setUser(undefined);\n      console.warn(error);\n    }\n  };\n\n  useEffect(() => {\n    if (!user) setUserInToken();\n  }, []);\n\n  const setDataInLocal = user => {\n    try {\n      const date = getToday();\n      updateAPIHeader();\n\n      if (LocalStroage.recordTime(\"wakeTime\").isEmpty()) {\n        const wakeTime = LocalStroage.recordTime(\"wakeTime\").get();\n        APIv2.recordTime(user, date, \"wakeTime\").edit(wakeTime);\n        LocalStroage.recordTime(\"wakeTime\").remove();\n      }\n\n      if (LocalStroage.recordTime(\"bedTime\").isEmpty()) {\n        const bedTime = LocalStroage.recordTime(\"bedTime\").get();\n        APIv2.recordTime(user, date, \"bedTime\").edit(bedTime);\n        LocalStroage.recordTime(\"bedTime\").remove();\n      }\n\n      if (LocalStroage.workList().isEmpty()) {\n        const workList = LocalStroage.workList(\"workList\").get();\n        APIv2.workList(user, date, \"workList\").update(workList);\n        LocalStroage.workList(\"workList\").remove();\n      }\n    } catch (error) {\n      alert(error);\n    }\n  };\n\n  const authenticated = user != null;\n\n  const login = async (userInfo, socialType) => {\n    // setUser(signIn({ email, password }));\n    try {\n      const response = await API.post(`/auth/login/${socialType}`, {\n        userInfo\n      });\n      const {\n        access_token,\n        username\n      } = response.data;\n      localStorage.setItem(\"access_token\", JSON.stringify(access_token));\n      setUser(username);\n      if (localStorage.getItem(\"access_token\")) setDataInLocal(username);\n    } catch (error) {\n      console.log(\"WHY NOT ERR\");\n      throw error;\n    }\n  };\n\n  const logout = () => {\n    setUser(null);\n    localStorage.removeItem(\"access_token\");\n    updateAPIHeader();\n  };\n\n  return [user, setUser, authenticated, login, logout];\n};\n\n_s(useLogin, \"eut8pu0J7NBf6pFClhWcR4CdQKk=\");","map":{"version":3,"sources":["/home/invidam/hamburger_calender/src/hooks/user/useLogin.js"],"names":["useEffect","useState","API","APIv2","updateAPIHeader","LocalStroage","getToday","verifyToken","token","JSON","parse","localStorage","getItem","response","post","data","decode","useLogin","user","setUser","setUserInToken","setItem","Error","username","console","log","error","undefined","warn","setDataInLocal","date","recordTime","isEmpty","wakeTime","get","edit","remove","bedTime","workList","update","alert","authenticated","login","userInfo","socialType","access_token","stringify","logout","removeItem"],"mappings":"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","sourcesContent":["import { useEffect, useState } from \"react\";\nimport { API, APIv2, updateAPIHeader } from \"../../tools/API\";\nimport { LocalStroage } from \"../../tools/LocalStorage\";\nimport { getToday } from \"../../tools/time\";\n\nconst verifyToken = async () => {\n  const { token } = JSON.parse(localStorage.getItem(\"access_token\"));\n  const response = await API.post(\"/api/jwt/verify\", { token });\n  return response.data.decode;\n};\n\nexport const useLogin = () => {\n  const [user, setUser] = useState(\"Loading\");\n  const setUserInToken = async () => {\n    try {\n      if (\n        !localStorage.getItem(\"access_token\") ||\n        localStorage.getItem(\"access_token\") === \"undefined\"\n      ) {\n        localStorage.setItem(\"access_token\", \"undefined\");\n        throw new Error(\"access_token not exists.\");\n      }\n      const { username } = await verifyToken();\n      console.log(\"user find! \", username);\n      setUser(username);\n    } catch (error) {\n      setUser(undefined);\n      console.warn(error);\n    }\n  };\n  useEffect(() => {\n    if (!user) setUserInToken();\n  }, []);\n  const setDataInLocal = (user) => {\n    try {\n      const date = getToday();\n      updateAPIHeader();\n      if (LocalStroage.recordTime(\"wakeTime\").isEmpty()) {\n        const wakeTime = LocalStroage.recordTime(\"wakeTime\").get();\n        APIv2.recordTime(user, date, \"wakeTime\").edit(wakeTime);\n        LocalStroage.recordTime(\"wakeTime\").remove();\n      }\n      if (LocalStroage.recordTime(\"bedTime\").isEmpty()) {\n        const bedTime = LocalStroage.recordTime(\"bedTime\").get();\n        APIv2.recordTime(user, date, \"bedTime\").edit(bedTime);\n        LocalStroage.recordTime(\"bedTime\").remove();\n      }\n      if (LocalStroage.workList().isEmpty()) {\n        const workList = LocalStroage.workList(\"workList\").get();\n        APIv2.workList(user, date, \"workList\").update(workList);\n        LocalStroage.workList(\"workList\").remove();\n      }\n    } catch (error) {\n      alert(error);\n    }\n  };\n  const authenticated = user != null;\n  const login = async (userInfo, socialType) => {\n    // setUser(signIn({ email, password }));\n    try {\n      const response = await API.post(`/auth/login/${socialType}`, {\n        userInfo,\n      });\n      const { access_token, username } = response.data;\n      localStorage.setItem(\"access_token\", JSON.stringify(access_token));\n      setUser(username);\n      if (localStorage.getItem(\"access_token\")) setDataInLocal(username);\n    } catch (error) {\n      console.log(\"WHY NOT ERR\");\n      throw error;\n    }\n  };\n  const logout = () => {\n    setUser(null);\n    localStorage.removeItem(\"access_token\");\n    updateAPIHeader();\n  };\n\n  return [user, setUser, authenticated, login, logout];\n};\n"]},"metadata":{},"sourceType":"module"}