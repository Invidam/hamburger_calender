{"ast":null,"code":"const {\n  improvedDH\n} = require('../../help/runtime_support');\n\nconst {\n  KEYLENGTHS\n} = require('../../registry');\n\nconst {\n  generateSync\n} = require('../../jwk/generate');\n\nconst derive = require('./derive');\n\nconst wrapKey = (key, payload, {\n  enc\n}) => {\n  const epk = generateSync(key.kty, key.crv);\n  const derivedKey = derive(enc, KEYLENGTHS.get(enc), epk, key);\n  return {\n    wrapped: derivedKey,\n    header: {\n      epk: {\n        kty: key.kty,\n        crv: key.crv,\n        x: epk.x,\n        y: epk.y\n      }\n    }\n  };\n};\n\nconst unwrapKey = (key, payload, header) => {\n  const {\n    enc,\n    epk\n  } = header;\n  return derive(enc, KEYLENGTHS.get(enc), key, epk, header);\n};\n\nmodule.exports = (JWA, JWK) => {\n  JWA.keyManagementEncrypt.set('ECDH-ES', wrapKey);\n  JWA.keyManagementDecrypt.set('ECDH-ES', unwrapKey);\n\n  JWK.EC.deriveKey['ECDH-ES'] = key => (key.use === 'enc' || key.use === undefined) && key.crv !== 'secp256k1';\n\n  if (improvedDH) {\n    JWK.OKP.deriveKey['ECDH-ES'] = key => (key.use === 'enc' || key.use === undefined) && key.keyObject.asymmetricKeyType.startsWith('x');\n  }\n};","map":{"version":3,"sources":["/home/invidam/hamburger_calender/client/node_modules/jose/lib/jwa/ecdh/dir.js"],"names":["improvedDH","require","KEYLENGTHS","generateSync","derive","wrapKey","key","payload","enc","epk","kty","crv","derivedKey","get","wrapped","header","x","y","unwrapKey","module","exports","JWA","JWK","keyManagementEncrypt","set","keyManagementDecrypt","EC","deriveKey","use","undefined","OKP","keyObject","asymmetricKeyType","startsWith"],"mappings":"AAAA,MAAM;AAAEA,EAAAA;AAAF,IAAiBC,OAAO,CAAC,4BAAD,CAA9B;;AACA,MAAM;AAAEC,EAAAA;AAAF,IAAiBD,OAAO,CAAC,gBAAD,CAA9B;;AACA,MAAM;AAAEE,EAAAA;AAAF,IAAmBF,OAAO,CAAC,oBAAD,CAAhC;;AAEA,MAAMG,MAAM,GAAGH,OAAO,CAAC,UAAD,CAAtB;;AAEA,MAAMI,OAAO,GAAG,CAACC,GAAD,EAAMC,OAAN,EAAe;AAAEC,EAAAA;AAAF,CAAf,KAA2B;AACzC,QAAMC,GAAG,GAAGN,YAAY,CAACG,GAAG,CAACI,GAAL,EAAUJ,GAAG,CAACK,GAAd,CAAxB;AAEA,QAAMC,UAAU,GAAGR,MAAM,CAACI,GAAD,EAAMN,UAAU,CAACW,GAAX,CAAeL,GAAf,CAAN,EAA2BC,GAA3B,EAAgCH,GAAhC,CAAzB;AAEA,SAAO;AACLQ,IAAAA,OAAO,EAAEF,UADJ;AAELG,IAAAA,MAAM,EAAE;AAAEN,MAAAA,GAAG,EAAE;AAAEC,QAAAA,GAAG,EAAEJ,GAAG,CAACI,GAAX;AAAgBC,QAAAA,GAAG,EAAEL,GAAG,CAACK,GAAzB;AAA8BK,QAAAA,CAAC,EAAEP,GAAG,CAACO,CAArC;AAAwCC,QAAAA,CAAC,EAAER,GAAG,CAACQ;AAA/C;AAAP;AAFH,GAAP;AAID,CATD;;AAWA,MAAMC,SAAS,GAAG,CAACZ,GAAD,EAAMC,OAAN,EAAeQ,MAAf,KAA0B;AAC1C,QAAM;AAAEP,IAAAA,GAAF;AAAOC,IAAAA;AAAP,MAAeM,MAArB;AACA,SAAOX,MAAM,CAACI,GAAD,EAAMN,UAAU,CAACW,GAAX,CAAeL,GAAf,CAAN,EAA2BF,GAA3B,EAAgCG,GAAhC,EAAqCM,MAArC,CAAb;AACD,CAHD;;AAKAI,MAAM,CAACC,OAAP,GAAiB,CAACC,GAAD,EAAMC,GAAN,KAAc;AAC7BD,EAAAA,GAAG,CAACE,oBAAJ,CAAyBC,GAAzB,CAA6B,SAA7B,EAAwCnB,OAAxC;AACAgB,EAAAA,GAAG,CAACI,oBAAJ,CAAyBD,GAAzB,CAA6B,SAA7B,EAAwCN,SAAxC;;AACAI,EAAAA,GAAG,CAACI,EAAJ,CAAOC,SAAP,CAAiB,SAAjB,IAA8BrB,GAAG,IAAI,CAACA,GAAG,CAACsB,GAAJ,KAAY,KAAZ,IAAqBtB,GAAG,CAACsB,GAAJ,KAAYC,SAAlC,KAAgDvB,GAAG,CAACK,GAAJ,KAAY,WAAjG;;AAEA,MAAIX,UAAJ,EAAgB;AACdsB,IAAAA,GAAG,CAACQ,GAAJ,CAAQH,SAAR,CAAkB,SAAlB,IAA+BrB,GAAG,IAAI,CAACA,GAAG,CAACsB,GAAJ,KAAY,KAAZ,IAAqBtB,GAAG,CAACsB,GAAJ,KAAYC,SAAlC,KAAgDvB,GAAG,CAACyB,SAAJ,CAAcC,iBAAd,CAAgCC,UAAhC,CAA2C,GAA3C,CAAtF;AACD;AACF,CARD","sourcesContent":["const { improvedDH } = require('../../help/runtime_support')\nconst { KEYLENGTHS } = require('../../registry')\nconst { generateSync } = require('../../jwk/generate')\n\nconst derive = require('./derive')\n\nconst wrapKey = (key, payload, { enc }) => {\n  const epk = generateSync(key.kty, key.crv)\n\n  const derivedKey = derive(enc, KEYLENGTHS.get(enc), epk, key)\n\n  return {\n    wrapped: derivedKey,\n    header: { epk: { kty: key.kty, crv: key.crv, x: epk.x, y: epk.y } }\n  }\n}\n\nconst unwrapKey = (key, payload, header) => {\n  const { enc, epk } = header\n  return derive(enc, KEYLENGTHS.get(enc), key, epk, header)\n}\n\nmodule.exports = (JWA, JWK) => {\n  JWA.keyManagementEncrypt.set('ECDH-ES', wrapKey)\n  JWA.keyManagementDecrypt.set('ECDH-ES', unwrapKey)\n  JWK.EC.deriveKey['ECDH-ES'] = key => (key.use === 'enc' || key.use === undefined) && key.crv !== 'secp256k1'\n\n  if (improvedDH) {\n    JWK.OKP.deriveKey['ECDH-ES'] = key => (key.use === 'enc' || key.use === undefined) && key.keyObject.asymmetricKeyType.startsWith('x')\n  }\n}\n"]},"metadata":{},"sourceType":"script"}