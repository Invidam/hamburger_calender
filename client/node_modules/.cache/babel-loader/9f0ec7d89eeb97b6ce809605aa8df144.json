{"ast":null,"code":"\"use strict\";\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spread = this && this.__spread || function () {\n  for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\n\n  return ar;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar lru_cache_1 = __importDefault(require(\"lru-cache\"));\n\nvar events_1 = require(\"events\");\n\nvar lodash_clonedeep_1 = __importDefault(require(\"lodash.clonedeep\"));\n\nvar freeze_1 = require(\"./freeze\");\n\nfunction syncMemoizer(options) {\n  var cache = new lru_cache_1.default(options);\n  var load = options.load;\n  var hash = options.hash;\n  var bypass = options.bypass;\n  var itemMaxAge = options.itemMaxAge;\n  var freeze = options.freeze;\n  var clone = options.clone;\n  var emitter = new events_1.EventEmitter();\n  var defaultResult = Object.assign({\n    del: del,\n    reset: function () {\n      return cache.reset();\n    },\n    keys: cache.keys.bind(cache),\n    on: emitter.on.bind(emitter),\n    once: emitter.once.bind(emitter)\n  }, options);\n\n  if (options.disable) {\n    return Object.assign(load, defaultResult);\n  }\n\n  function del() {\n    var key = hash.apply(void 0, __spread(arguments));\n    cache.del(key);\n  }\n\n  function emit(event) {\n    var parameters = [];\n\n    for (var _i = 1; _i < arguments.length; _i++) {\n      parameters[_i - 1] = arguments[_i];\n    }\n\n    emitter.emit.apply(emitter, __spread([event], parameters));\n  }\n\n  function isPromise(result) {\n    // detect native, bluebird, A+ promises\n    return result && result.then && typeof result.then === 'function';\n  }\n\n  function processResult(result) {\n    var res = result;\n\n    if (clone) {\n      if (isPromise(res)) {\n        res = res.then(lodash_clonedeep_1.default);\n      } else {\n        res = lodash_clonedeep_1.default(res);\n      }\n    }\n\n    if (freeze) {\n      if (isPromise(res)) {\n        res = res.then(freeze_1.deepFreeze);\n      } else {\n        freeze_1.deepFreeze(res);\n      }\n    }\n\n    return res;\n  }\n\n  var result = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    if (bypass && bypass.apply(void 0, __spread(args))) {\n      emit.apply(void 0, __spread(['miss'], args));\n      return load.apply(void 0, __spread(args));\n    }\n\n    var key = hash.apply(void 0, __spread(args));\n    var fromCache = cache.get(key);\n\n    if (fromCache) {\n      emit.apply(void 0, __spread(['hit'], args));\n      return processResult(fromCache);\n    }\n\n    emit.apply(void 0, __spread(['miss'], args));\n    var result = load.apply(void 0, __spread(args));\n\n    if (itemMaxAge) {\n      // @ts-ignore\n      cache.set(key, result, itemMaxAge.apply(void 0, __spread(args.concat([result]))));\n    } else {\n      cache.set(key, result);\n    }\n\n    return processResult(result);\n  };\n\n  return Object.assign(result, defaultResult);\n}\n\nexports.syncMemoizer = syncMemoizer;","map":{"version":3,"sources":["../src/sync.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spread = (this && this.__spread) || function () {\n    for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\n    return ar;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar lru_cache_1 = __importDefault(require(\"lru-cache\"));\nvar events_1 = require(\"events\");\nvar lodash_clonedeep_1 = __importDefault(require(\"lodash.clonedeep\"));\nvar freeze_1 = require(\"./freeze\");\nfunction syncMemoizer(options) {\n    var cache = new lru_cache_1.default(options);\n    var load = options.load;\n    var hash = options.hash;\n    var bypass = options.bypass;\n    var itemMaxAge = options.itemMaxAge;\n    var freeze = options.freeze;\n    var clone = options.clone;\n    var emitter = new events_1.EventEmitter();\n    var defaultResult = Object.assign({\n        del: del,\n        reset: function () { return cache.reset(); },\n        keys: cache.keys.bind(cache),\n        on: emitter.on.bind(emitter),\n        once: emitter.once.bind(emitter)\n    }, options);\n    if (options.disable) {\n        return Object.assign(load, defaultResult);\n    }\n    function del() {\n        var key = hash.apply(void 0, __spread(arguments));\n        cache.del(key);\n    }\n    function emit(event) {\n        var parameters = [];\n        for (var _i = 1; _i < arguments.length; _i++) {\n            parameters[_i - 1] = arguments[_i];\n        }\n        emitter.emit.apply(emitter, __spread([event], parameters));\n    }\n    function isPromise(result) {\n        // detect native, bluebird, A+ promises\n        return result && result.then && typeof result.then === 'function';\n    }\n    function processResult(result) {\n        var res = result;\n        if (clone) {\n            if (isPromise(res)) {\n                res = res.then(lodash_clonedeep_1.default);\n            }\n            else {\n                res = lodash_clonedeep_1.default(res);\n            }\n        }\n        if (freeze) {\n            if (isPromise(res)) {\n                res = res.then(freeze_1.deepFreeze);\n            }\n            else {\n                freeze_1.deepFreeze(res);\n            }\n        }\n        return res;\n    }\n    var result = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        if (bypass && bypass.apply(void 0, __spread(args))) {\n            emit.apply(void 0, __spread(['miss'], args));\n            return load.apply(void 0, __spread(args));\n        }\n        var key = hash.apply(void 0, __spread(args));\n        var fromCache = cache.get(key);\n        if (fromCache) {\n            emit.apply(void 0, __spread(['hit'], args));\n            return processResult(fromCache);\n        }\n        emit.apply(void 0, __spread(['miss'], args));\n        var result = load.apply(void 0, __spread(args));\n        if (itemMaxAge) {\n            // @ts-ignore\n            cache.set(key, result, itemMaxAge.apply(void 0, __spread(args.concat([result]))));\n        }\n        else {\n            cache.set(key, result);\n        }\n        return processResult(result);\n    };\n    return Object.assign(result, defaultResult);\n}\nexports.syncMemoizer = syncMemoizer;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3luYy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9zeW5jLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSx3REFBNEI7QUFDNUIsaUNBQXNDO0FBQ3RDLHNFQUF5QztBQUN6QyxtQ0FBc0M7QUF5RHRDLFNBQWdCLFlBQVksQ0FDeEIsT0FBb0Q7SUFFdEQsSUFBTSxLQUFLLEdBQVEsSUFBSSxtQkFBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ3BDLElBQU0sSUFBSSxHQUFTLE9BQU8sQ0FBQyxJQUFJLENBQUM7SUFDaEMsSUFBTSxJQUFJLEdBQVMsT0FBTyxDQUFDLElBQUksQ0FBQztJQUNoQyxJQUFNLE1BQU0sR0FBTyxPQUFPLENBQUMsTUFBTSxDQUFDO0lBQ2xDLElBQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxVQUFVLENBQUM7SUFDdEMsSUFBTSxNQUFNLEdBQU8sT0FBTyxDQUFDLE1BQU0sQ0FBQztJQUNsQyxJQUFNLEtBQUssR0FBUSxPQUFPLENBQUMsS0FBSyxDQUFDO0lBQ2pDLElBQU0sT0FBTyxHQUFNLElBQUkscUJBQVksRUFBRSxDQUFDO0lBRXRDLElBQU0sYUFBYSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUM7UUFDbEMsR0FBRyxLQUFBO1FBQ0gsS0FBSyxFQUFFLGNBQU0sT0FBQSxLQUFLLENBQUMsS0FBSyxFQUFFLEVBQWIsQ0FBYTtRQUMxQixJQUFJLEVBQUUsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDO1FBQzVCLEVBQUUsRUFBRSxPQUFPLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUM7UUFDNUIsSUFBSSxFQUFFLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQztLQUNqQyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBRVosSUFBSSxPQUFPLENBQUMsT0FBTyxFQUFFO1FBQ25CLE9BQU8sTUFBTSxDQUFD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"]},"metadata":{},"sourceType":"script"}