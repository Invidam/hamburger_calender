{"ast":null,"code":"import _slicedToArray from\"/home/invidam/hamburger_calender/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _regeneratorRuntime from\"/home/invidam/hamburger_calender/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/invidam/hamburger_calender/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{useEffect,useState}from\"react\";import{API,updateAPIHeader}from\"../../tools/API\";import{LocalStroage}from\"../../tools/LocalStorage\";import{getToday}from\"../../tools/time\";var verifyToken=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return API.auth().verifyToken();case 2:response=_context.sent;return _context.abrupt(\"return\",response.data.decode);case 4:case\"end\":return _context.stop();}}},_callee);}));return function verifyToken(){return _ref.apply(this,arguments);};}();export var useLogin=function useLogin(){var _useState=useState(),_useState2=_slicedToArray(_useState,2),user=_useState2[0],setUser=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),isTokenLoading=_useState4[0],setLoadInToken=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isLoginLoading=_useState6[0],setLoadInLoading=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),isLoginHookLoading=_useState8[0],setLoad=_useState8[1];useEffect(function(){console.log(\"[login]TOKEN\",isTokenLoading,\"LOGIN\",isLoginLoading,\"RESULT: \",isTokenLoading||isLoginLoading);setLoad(isTokenLoading||isLoginLoading);},[isTokenLoading,isLoginLoading]);var setUserInToken=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _yield$verifyToken,username;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;if(!LocalStroage.accessToken().isEmpty()){_context2.next=8;break;}console.log(\"user FIND! \");LocalStroage.accessToken().set(undefined);// throw new Error(\"access_token not exists.\");\nconsole.log(\"TOKEN\",isTokenLoading,\"LOGIN\",isLoginLoading,\"RESULT: \",isTokenLoading||isLoginLoading);setLoadInToken(false);_context2.next=15;break;case 8:_context2.next=10;return verifyToken();case 10:_yield$verifyToken=_context2.sent;username=_yield$verifyToken.username;console.log(\"user find! \",username);setLoadInToken(false);setUser(username);case 15:_context2.next=23;break;case 17:_context2.prev=17;_context2.t0=_context2[\"catch\"](0);alert(_context2.t0);setLoadInToken(false);setUser(undefined);LocalStroage.accessToken().remove();case 23:case\"end\":return _context2.stop();}}},_callee2,null,[[0,17]]);}));return function setUserInToken(){return _ref2.apply(this,arguments);};}();useEffect(function(){console.log(\"USE EFFECT APPROACH\");setUserInToken();},[user]);var setDataInLocal=function setDataInLocal(user){try{console.log(\"TOKEN START\");var date=getToday();updateAPIHeader();if(!LocalStroage.recordTime(\"wakeTime\").isEmpty()){var wakeTime=LocalStroage.recordTime(\"wakeTime\").get();API.recordTime(user,date,\"wakeTime\").edit(wakeTime);LocalStroage.recordTime(\"wakeTime\").remove();}if(!LocalStroage.recordTime(\"bedTime\").isEmpty()){var bedTime=LocalStroage.recordTime(\"bedTime\").get();API.recordTime(user,date,\"bedTime\").edit(bedTime);LocalStroage.recordTime(\"bedTime\").remove();}if(!LocalStroage.workList().isEmpty()){var workList=LocalStroage.workList(\"workList\").get();API.workList(user,date).edit(workList);LocalStroage.workList().remove();}if(!LocalStroage.todoList().isEmpty()){console.log(\"IS EMPTY TODO \");var todoList=LocalStroage.todoList(\"todoList\").get();API.todoList(user).edit(todoList);LocalStroage.todoList().remove();}}catch(error){alert(error);}};var authenticated=user!=null;var login=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(userInfo,socialType){var response,_response$data,access_token,username;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;setLoadInLoading(true);// const response = await API.post(`/auth/login/${socialType}`, {\n//   userInfo,\n// });\n_context3.next=4;return API.auth().login(socialType,userInfo);case 4:response=_context3.sent;_response$data=response.data,access_token=_response$data.access_token,username=_response$data.username;LocalStroage.accessToken().set(access_token);setUser(username);console.log(\"login success ~~~~~~~~~~~\");if(!LocalStroage.accessToken().isEmpty()){setDataInLocal(username);setLoadInLoading(false);}_context3.next=16;break;case 12:_context3.prev=12;_context3.t0=_context3[\"catch\"](0);setLoadInLoading(false);throw _context3.t0;case 16:case\"end\":return _context3.stop();}}},_callee3,null,[[0,12]]);}));return function login(_x,_x2){return _ref3.apply(this,arguments);};}();var logout=function logout(){setUser(null);LocalStroage.accessToken().remove();updateAPIHeader();};return[user,setUser,authenticated,login,logout,isLoginHookLoading];};","map":{"version":3,"sources":["/home/invidam/hamburger_calender/src/hooks/user/useLogin.js"],"names":["useEffect","useState","API","updateAPIHeader","LocalStroage","getToday","verifyToken","auth","response","data","decode","useLogin","user","setUser","isTokenLoading","setLoadInToken","isLoginLoading","setLoadInLoading","isLoginHookLoading","setLoad","console","log","setUserInToken","accessToken","isEmpty","set","undefined","username","alert","remove","setDataInLocal","date","recordTime","wakeTime","get","edit","bedTime","workList","todoList","error","authenticated","login","userInfo","socialType","access_token","logout"],"mappings":"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","sourcesContent":["import { useEffect, useState } from \"react\";\nimport { API, updateAPIHeader } from \"../../tools/API\";\nimport { LocalStroage } from \"../../tools/LocalStorage\";\nimport { getToday } from \"../../tools/time\";\n\nconst verifyToken = async () => {\n  const response = await API.auth().verifyToken(); //await API.post(\"/api/jwt/verify\", { token });\n  return response.data.decode;\n};\n\nexport const useLogin = () => {\n  const [user, setUser] = useState();\n  const [isTokenLoading, setLoadInToken] = useState(true);\n  const [isLoginLoading, setLoadInLoading] = useState(false);\n  const [isLoginHookLoading, setLoad] = useState(true);\n  useEffect(() => {\n    console.log(\n      \"[login]TOKEN\",\n      isTokenLoading,\n      \"LOGIN\",\n      isLoginLoading,\n      \"RESULT: \",\n      isTokenLoading || isLoginLoading\n    );\n    setLoad(isTokenLoading || isLoginLoading);\n  }, [isTokenLoading, isLoginLoading]);\n  const setUserInToken = async () => {\n    try {\n      if (LocalStroage.accessToken().isEmpty()) {\n        console.log(\"user FIND! \");\n        LocalStroage.accessToken().set(undefined);\n        // throw new Error(\"access_token not exists.\");\n        console.log(\n          \"TOKEN\",\n          isTokenLoading,\n          \"LOGIN\",\n          isLoginLoading,\n          \"RESULT: \",\n          isTokenLoading || isLoginLoading\n        );\n        setLoadInToken(false);\n      } else {\n        // setLoadInToken(true);\n        const { username } = await verifyToken();\n        console.log(\"user find! \", username);\n        setLoadInToken(false);\n        setUser(username);\n      }\n    } catch (error) {\n      alert(error);\n      setLoadInToken(false);\n      setUser(undefined);\n      LocalStroage.accessToken().remove();\n    }\n  };\n  useEffect(() => {\n    console.log(\"USE EFFECT APPROACH\");\n    setUserInToken();\n  }, [user]);\n  const setDataInLocal = (user) => {\n    try {\n      console.log(\"TOKEN START\");\n      const date = getToday();\n      updateAPIHeader();\n      if (!LocalStroage.recordTime(\"wakeTime\").isEmpty()) {\n        const wakeTime = LocalStroage.recordTime(\"wakeTime\").get();\n        API.recordTime(user, date, \"wakeTime\").edit(wakeTime);\n        LocalStroage.recordTime(\"wakeTime\").remove();\n      }\n      if (!LocalStroage.recordTime(\"bedTime\").isEmpty()) {\n        const bedTime = LocalStroage.recordTime(\"bedTime\").get();\n        API.recordTime(user, date, \"bedTime\").edit(bedTime);\n        LocalStroage.recordTime(\"bedTime\").remove();\n      }\n      if (!LocalStroage.workList().isEmpty()) {\n        const workList = LocalStroage.workList(\"workList\").get();\n        API.workList(user, date).edit(workList);\n        LocalStroage.workList().remove();\n      }\n      if (!LocalStroage.todoList().isEmpty()) {\n        console.log(\"IS EMPTY TODO \");\n        const todoList = LocalStroage.todoList(\"todoList\").get();\n        API.todoList(user).edit(todoList);\n        LocalStroage.todoList().remove();\n      }\n    } catch (error) {\n      alert(error);\n    }\n  };\n  const authenticated = user != null;\n  const login = async (userInfo, socialType) => {\n    // setUser(signIn({ email, password }));\n    try {\n      setLoadInLoading(true);\n      // const response = await API.post(`/auth/login/${socialType}`, {\n      //   userInfo,\n      // });\n      const response = await API.auth().login(socialType, userInfo);\n      const { access_token, username } = response.data;\n      LocalStroage.accessToken().set(access_token);\n      setUser(username);\n      console.log(\"login success ~~~~~~~~~~~\");\n      if (!LocalStroage.accessToken().isEmpty()) {\n        setDataInLocal(username);\n        setLoadInLoading(false);\n      }\n    } catch (error) {\n      setLoadInLoading(false);\n      throw error;\n    }\n  };\n  const logout = () => {\n    setUser(null);\n    LocalStroage.accessToken().remove();\n    updateAPIHeader();\n  };\n\n  return [user, setUser, authenticated, login, logout, isLoginHookLoading];\n};\n"]},"metadata":{},"sourceType":"module"}