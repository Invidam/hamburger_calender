{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport { useEffect, useState } from \"react\";\nimport { API, APIv2, updateAPIHeader } from \"../../tools/API\";\nimport { LocalStroage } from \"../../tools/LocalStorage\";\nimport { getToday } from \"../../tools/time\";\n\nconst verifyToken = async () => {\n  const {\n    token\n  } = LocalStroage.accessToken().get();\n  const response = await APIv2.auth().verifyToken(token); //await API.post(\"/api/jwt/verify\", { token });\n\n  return response.data.decode;\n};\n\nexport const useLogin = () => {\n  _s();\n\n  const [user, setUser] = useState();\n  const [isTokenLoading, setLoadInToken] = useState(true);\n  const [isLoginLoading, setLoadInLoading] = useState(true);\n  let isLoginHookLoading = true;\n  useEffect(() => isLoginHookLoading = isTokenLoading || isLoginLoading, [isTokenLoading, isLoginLoading]);\n\n  const setUserInToken = async () => {\n    try {\n      setLoadInToken(true);\n\n      if (LocalStroage.accessToken().isEmpty()) {\n        console.log(\"user FIND! \");\n        LocalStroage.accessToken().set(undefined); // throw new Error(\"access_token not exists.\");\n      } else {\n        const {\n          username\n        } = await verifyToken();\n        console.log(\"user find! \", username);\n        setUser(username);\n      }\n\n      if (isTokenLoading) setLoadInToken(false);\n    } catch (error) {\n      alert(error);\n      setLoadInToken(false);\n      setUser(undefined);\n    }\n  };\n\n  useEffect(() => {\n    console.log(\"USE EFFECT APPROACH\");\n    setUserInToken();\n  }, []);\n\n  const setDataInLocal = user => {\n    try {\n      const date = getToday();\n      updateAPIHeader();\n\n      if (LocalStroage.recordTime(\"wakeTime\").isEmpty()) {\n        const wakeTime = LocalStroage.recordTime(\"wakeTime\").get();\n        APIv2.recordTime(user, date, \"wakeTime\").edit(wakeTime);\n        LocalStroage.recordTime(\"wakeTime\").remove();\n      }\n\n      if (LocalStroage.recordTime(\"bedTime\").isEmpty()) {\n        const bedTime = LocalStroage.recordTime(\"bedTime\").get();\n        APIv2.recordTime(user, date, \"bedTime\").edit(bedTime);\n        LocalStroage.recordTime(\"bedTime\").remove();\n      }\n\n      if (LocalStroage.workList().isEmpty()) {\n        const workList = LocalStroage.workList(\"workList\").get();\n        APIv2.workList(user, date, \"workList\").edit(workList);\n        LocalStroage.workList(\"workList\").remove();\n      }\n    } catch (error) {\n      alert(error);\n    }\n  };\n\n  const authenticated = user != null;\n\n  const login = async (userInfo, socialType) => {\n    // setUser(signIn({ email, password }));\n    try {\n      console.log(\"SET LOAD TRUE\");\n      setLoadInLoading(true); // const response = await API.post(`/auth/login/${socialType}`, {\n      //   userInfo,\n      // });\n\n      const response = await APIv2.auth().login(socialType, userInfo);\n      const {\n        access_token,\n        username\n      } = response.data;\n      LocalStroage.accessToken().set(access_token);\n      setUser(username);\n\n      if (!LocalStroage.accessToken().isEmpty()) {\n        setDataInLocal(username);\n        console.log(\"set load false\", userInfo);\n        setLoadInLoading(false);\n      }\n    } catch (error) {\n      setLoadInLoading(false);\n      console.log(\"WHY NOT ERR\");\n      throw error;\n    }\n  };\n\n  const logout = () => {\n    setUser(null);\n    LocalStroage.accessToken().remove();\n    updateAPIHeader();\n  };\n\n  return [user, setUser, authenticated, login, logout, isLoginHookLoading];\n};\n\n_s(useLogin, \"9wZqRZ35m+NQ1yOO0NlD85YoiXw=\");","map":{"version":3,"sources":["/home/invidam/hamburger_calender/src/hooks/user/useLogin.js"],"names":["useEffect","useState","API","APIv2","updateAPIHeader","LocalStroage","getToday","verifyToken","token","accessToken","get","response","auth","data","decode","useLogin","user","setUser","isTokenLoading","setLoadInToken","isLoginLoading","setLoadInLoading","isLoginHookLoading","setUserInToken","isEmpty","console","log","set","undefined","username","error","alert","setDataInLocal","date","recordTime","wakeTime","edit","remove","bedTime","workList","authenticated","login","userInfo","socialType","access_token","logout"],"mappings":"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","sourcesContent":["import { useEffect, useState } from \"react\";\nimport { API, APIv2, updateAPIHeader } from \"../../tools/API\";\nimport { LocalStroage } from \"../../tools/LocalStorage\";\nimport { getToday } from \"../../tools/time\";\n\nconst verifyToken = async () => {\n  const { token } = LocalStroage.accessToken().get();\n  const response = await APIv2.auth().verifyToken(token); //await API.post(\"/api/jwt/verify\", { token });\n  return response.data.decode;\n};\n\nexport const useLogin = () => {\n  const [user, setUser] = useState();\n  const [isTokenLoading, setLoadInToken] = useState(true);\n  const [isLoginLoading, setLoadInLoading] = useState(true);\n\n  let isLoginHookLoading = true;\n  useEffect(\n    () => (isLoginHookLoading = isTokenLoading || isLoginLoading),\n    [isTokenLoading, isLoginLoading]\n  );\n  const setUserInToken = async () => {\n    try {\n      setLoadInToken(true);\n      if (LocalStroage.accessToken().isEmpty()) {\n        console.log(\"user FIND! \");\n        LocalStroage.accessToken().set(undefined);\n        // throw new Error(\"access_token not exists.\");\n      } else {\n        const { username } = await verifyToken();\n        console.log(\"user find! \", username);\n        setUser(username);\n      }\n      if (isTokenLoading) setLoadInToken(false);\n    } catch (error) {\n      alert(error);\n      setLoadInToken(false);\n      setUser(undefined);\n    }\n  };\n  useEffect(() => {\n    console.log(\"USE EFFECT APPROACH\");\n    setUserInToken();\n  }, []);\n  const setDataInLocal = (user) => {\n    try {\n      const date = getToday();\n      updateAPIHeader();\n      if (LocalStroage.recordTime(\"wakeTime\").isEmpty()) {\n        const wakeTime = LocalStroage.recordTime(\"wakeTime\").get();\n        APIv2.recordTime(user, date, \"wakeTime\").edit(wakeTime);\n        LocalStroage.recordTime(\"wakeTime\").remove();\n      }\n      if (LocalStroage.recordTime(\"bedTime\").isEmpty()) {\n        const bedTime = LocalStroage.recordTime(\"bedTime\").get();\n        APIv2.recordTime(user, date, \"bedTime\").edit(bedTime);\n        LocalStroage.recordTime(\"bedTime\").remove();\n      }\n      if (LocalStroage.workList().isEmpty()) {\n        const workList = LocalStroage.workList(\"workList\").get();\n        APIv2.workList(user, date, \"workList\").edit(workList);\n        LocalStroage.workList(\"workList\").remove();\n      }\n    } catch (error) {\n      alert(error);\n    }\n  };\n  const authenticated = user != null;\n  const login = async (userInfo, socialType) => {\n    // setUser(signIn({ email, password }));\n    try {\n      console.log(\"SET LOAD TRUE\");\n      setLoadInLoading(true);\n      // const response = await API.post(`/auth/login/${socialType}`, {\n      //   userInfo,\n      // });\n      const response = await APIv2.auth().login(socialType, userInfo);\n      const { access_token, username } = response.data;\n      LocalStroage.accessToken().set(access_token);\n      setUser(username);\n      if (!LocalStroage.accessToken().isEmpty()) {\n        setDataInLocal(username);\n        console.log(\"set load false\", userInfo);\n        setLoadInLoading(false);\n      }\n    } catch (error) {\n      setLoadInLoading(false);\n      console.log(\"WHY NOT ERR\");\n      throw error;\n    }\n  };\n  const logout = () => {\n    setUser(null);\n    LocalStroage.accessToken().remove();\n    updateAPIHeader();\n  };\n\n  return [user, setUser, authenticated, login, logout, isLoginHookLoading];\n};\n"]},"metadata":{},"sourceType":"module"}